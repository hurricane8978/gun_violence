<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Will a shooting incident become a murder?–a logistic regression approach</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="About.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exploratory Analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="National-visualization-analysis.html">National Visualization Analysis</a>
    </li>
    <li>
      <a href="NY-visualization-analysis.html">NY Visualization Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="time_series_analysis.html">Time Series Analysis Model</a>
</li>
<li>
  <a href="Logistic_muder.html">Regression Model</a>
</li>
<li>
  <a href="https://gun-violence-p8105.shinyapps.io/shiny/">Shiny</a>
</li>
<li>
  <a>
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a>
    <span class="fa fa-youtube fa-lg"></span>
     
  </a>
</li>
<li>
  <a>
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Will a shooting incident become a murder?–a logistic regression approach</h1>

</div>


<p>In the NYPD shooting incident database, a variable is called STATISTICAL_MURDER_FLAG which indicates if this shooting incident counted as a murder. It has a binary outcome “TRUE” or “FALSE”. We will use logistic regression model to identify if a shooting can become a murder.</p>
<div id="data-import" class="section level2">
<h2>Data Import</h2>
<pre class="r"><code>historic_NYPD_df = read_csv(&quot;./data/NYPD_Shooting_Incident_Data__Historic_.csv&quot;) 
year_to_date_df = read_csv(&quot;./data/NYPD_Shooting_Incident_Data__Year_To_Date_.csv&quot;)
df = bind_rows(historic_NYPD_df,year_to_date_df) 
 df = df %&gt;%
  separate(OCCUR_TIME,into = c(&quot;hour&quot;,&quot;minute&quot;,&quot;second&quot;),sep = &quot;:&quot;)%&gt;%
  separate(OCCUR_DATE,into = c(&quot;month&quot;,&quot;date&quot;,&quot;year&quot;),sep = &quot;/&quot;)%&gt;%
  mutate(hour=as.numeric(hour),
    time_period = case_when(
    hour&gt;=0 &amp; hour&lt;6 ~ &quot;MIDNIGHT&quot;,
           hour&gt;=6 &amp; hour&lt;12 ~ &quot;MORNING&quot;,
           hour&gt;=12 &amp; hour&lt;18 ~ &quot;AFTERNOON&quot;,
           hour&gt;=18 &amp; hour&lt;=23 ~ &quot;EVENING&quot;),
         month = as.factor(month))%&gt;%
  select(BORO,STATISTICAL_MURDER_FLAG,PERP_AGE_GROUP,PERP_SEX,PERP_RACE,VIC_AGE_GROUP,VIC_SEX,VIC_RACE,time_period,month)%&gt;%
  mutate(STATISTICAL_MURDER_FLAG = ifelse(STATISTICAL_MURDER_FLAG==&quot;TRUE&quot;, 1, 0),
         BORO = as.factor(BORO),
         PERP_AGE_GROUP = as.factor(PERP_AGE_GROUP),
         PERP_SEX = as.factor(PERP_SEX),
         PERP_RACE = as.factor(PERP_RACE),
         VIC_AGE_GROUP = as.factor(VIC_AGE_GROUP),
         VIC_SEX = as.factor(VIC_SEX),
         VIC_RACE = as.factor(VIC_RACE))%&gt;%
  na.omit()</code></pre>
<p>there are some irregular value and we need to deal with them.</p>
<pre class="r"><code>df=df[df$PERP_AGE_GROUP != &quot;UNKNOWN&quot;, ]
df=df[df$PERP_AGE_GROUP != &quot;1020&quot;, ]
df=df[df$PERP_AGE_GROUP != &quot;940&quot;, ]
df=df[df$PERP_AGE_GROUP != &quot;224&quot;, ]
df=df[df$PERP_SEX != &quot;U&quot;, ]
df=df[df$PERP_RACE != &quot;UNKNOWN&quot;, ]
df=df[df$VIC_SEX != &quot;U&quot;, ]
df=df[df$VIC_AGE_GROUP != &quot;UNKNOWN&quot;, ]</code></pre>
</div>
<div id="model-selection" class="section level2">
<h2>Model Selection</h2>
<p>First, build the initial logistic regression model with all variables</p>
<pre class="r"><code>fit = glm(STATISTICAL_MURDER_FLAG ~ BORO+PERP_AGE_GROUP+PERP_SEX+PERP_RACE+VIC_AGE_GROUP+VIC_SEX+VIC_RACE+time_period+month,data=df,family = binomial())
summary(fit)</code></pre>
<p>we can see from the above result that some variables do not pass the significance test. Now, we can use the stepwise method to choose variables.</p>
<pre class="r"><code>step(fit)</code></pre>
<p>Now, we test the reduced model from the above result</p>
<pre class="r"><code>fit_2 = glm(formula = STATISTICAL_MURDER_FLAG ~ BORO + PERP_AGE_GROUP + 
    PERP_RACE + VIC_AGE_GROUP + VIC_RACE + time_period, family = binomial(), 
    data = df)
summary(fit_2)</code></pre>
<p>We can see that PERP_RACE and PERP_RACE still not pass the significance test, now drop these two and run again</p>
<pre class="r"><code>fit_3 = glm(formula = STATISTICAL_MURDER_FLAG ~ BORO + PERP_AGE_GROUP + 
              VIC_AGE_GROUP +  time_period, family = binomial(), 
    data = df)
summary(fit_3)</code></pre>
<p>From the above result, we use dummy variables for BOROQUEENS,BOROSTATEN ISLAND,PERP_AGE_GROUP18-24</p>
<pre class="r"><code>df$QUEENS = ifelse(df$BORO==&quot;QUEENS&quot;,1,0)
df$STATEN = ifelse(df$BORO==&quot;STATEN ISLAND&quot;,1,0)
df$BROOKLYN = ifelse(df$BORO==&quot;BROOKLYN&quot;,1,0)
df$MANHATTAN = ifelse(df$BORO==&quot;MANHATTAN&quot;,1,0)
df$PERP_18 =ifelse(df$PERP_AGE_GROUP==&quot;18-24&quot;,1,0)
df$PERP_25 =ifelse(df$PERP_AGE_GROUP==&quot;25-44&quot;,1,0)
df$PERP_45 =ifelse(df$PERP_AGE_GROUP==&quot;45-64&quot;,1,0)
df$PERP_65 =ifelse(df$PERP_AGE_GROUP==&quot;65+&quot;,1,0)</code></pre>
<p>Run logistic regression with these dummy variables again and use stepwise method to filter.</p>
<pre class="r"><code>fit_4 = glm(formula = STATISTICAL_MURDER_FLAG ~ QUEENS + STATEN + BROOKLYN + MANHATTAN + PERP_18 + PERP_25 + PERP_45 + PERP_65 + 
              VIC_AGE_GROUP +  time_period, family = binomial(), 
    data = df)
summary(fit_4)
step(fit_4)</code></pre>
<p>now,we can run the model for the last time</p>
<pre class="r"><code>fit_5 = glm(formula = STATISTICAL_MURDER_FLAG ~ BROOKLYN + MANHATTAN + 
    PERP_25 + PERP_45 + PERP_65 + VIC_AGE_GROUP + time_period, 
    family = binomial(), data = df)
summary(fit_5)</code></pre>
<p>This model seems ok with all variables having significance. Now we test for the accuracy</p>
<pre class="r"><code>ifMudrer = function(glm.model, threshold = 0.5) {
  pre.pro = predict(glm.model, type = &quot;response&quot;)
  pre = if_else(pre.pro &gt;= threshold, 1, 0)
}
recall_accuracy(df$STATISTICAL_MURDER_FLAG,ifMudrer(fit_5))</code></pre>
<pre><code>## [1] 0.7634227</code></pre>
</div>
<div id="roc-plot" class="section level2">
<h2>ROC plot</h2>
<p>A receiver operating characteristic curve, or ROC curve, is a graphical plot that illustrates the diagnostic ability of a binary classifier system as its discrimination threshold is varied.The ROC curve is created by plotting the true positive rate (TPR) against the false positive rate (FPR) at various threshold settings.</p>
<pre class="r"><code>roc(df$STATISTICAL_MURDER_FLAG, predict(fit_5, type = &quot;response&quot;), algorithm = 3) %&gt;% 
  plot(auc.polygon = T,  print.thres = T, print.auc = T)</code></pre>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<p><img src="Logistic_muder_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The area under the curve can be used to quantitatively measure the effect of the model. The area under the ROC curve is denoted as AUC, so the larger AUC is, the better the model is. AUC for our model is 0.575 which is acceptable.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>At first, we would like to see the significance for each variable</p>
<pre class="r"><code>exp(fit_5$coefficients)</code></pre>
<pre><code>##         (Intercept)            BROOKLYN           MANHATTAN             PERP_25 
##           0.1893076           0.8968336           0.8850719           1.3618291 
##             PERP_45             PERP_65  VIC_AGE_GROUP18-24  VIC_AGE_GROUP25-44 
##           1.9209265           2.4727271           1.2569399           1.4176470 
##  VIC_AGE_GROUP45-64    VIC_AGE_GROUP65+  time_periodEVENING time_periodMIDNIGHT 
##           1.4643475           1.9122647           1.1213333           1.1380352 
##  time_periodMORNING 
##           1.3259992</code></pre>
<p>we can have the following conclusion:<br />
-Shooting incidents happen in BROOKLYN and MANHATTAN are less likely to be a murder.<br />
-When perpetrators’ age increases, the probability that this shooting incident to become a murder also increases. This conclusion holds for victims.<br />
-Shooting incidents happen in the morning are more like to be a murder.</p>
</div>
<div id="prediction" class="section level2">
<h2>Prediction</h2>
<p>For example, we have two shooting incidents now. We will use this model to predict which one has a higher probability to be a murder.<br />
–A 36-year-old white female was killed by a 20-year-old black male at 10pm in Brooklyn.<br />
–A 48-year-old Asian male was killed by a 54-year-old white male at 10am in Queens.</p>
<pre class="r"><code>test_data = data_frame(BROOKLYN = c(1,0) , MANHATTAN = c(0,0) ,PERP_25 = c(1,0),  PERP_45 =  c(0,1), PERP_65 = c(0,0) , VIC_AGE_GROUP = c(&quot;25-44&quot;,&quot;45-64&quot;),VIC_RACE = c(&quot;WHITE&quot;,&quot;ASIAN&quot;),VIC_SEX = c(&quot;F&quot;,&quot;M&quot;),time_period=c(&quot;EVENING&quot;,&quot;MORNING&quot;))</code></pre>
<pre><code>## Warning: `data_frame()` was deprecated in tibble 1.1.0.
## Please use `tibble()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre class="r"><code>test_data$prob = predict(fit_5, newdata=test_data, type=&quot;response&quot;)
test_data$prob</code></pre>
<pre><code>##         1         2 
## 0.2687603 0.4138679</code></pre>
<p>We can see tha the second one has a higher possibility to be amurder.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
